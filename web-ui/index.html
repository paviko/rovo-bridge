<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RovoBridge</title>
    <script>
      // Injected by backend template: see backend/internal/httpapi/http.go (UIHandlerWithCwd)
      // This allows TS bootstrap (initBootFromUrl) to read cwd and other boot params
      (function(){
        try {
          window.__BOOTSTRAP__ = window.__BOOTSTRAP__ || {};
          window.__BOOTSTRAP__.cwd = "{{.CWD}}";
        } catch (_) {}
      })();
    </script>
    <style>
      html, body { height: 100%; margin: 0; overflow: hidden; }
      /* Ensure the root uses full viewport and doesn't create a second scrollbar */
      #root { height: calc(100% - 2px); margin: 0 2px 2px; display: flex; flex-direction: column; min-height: 0; }
      /* Let the terminal area shrink inside flex layout and avoid outer scrollbars */
      #term { flex: 1 1 auto; min-height: 0; min-width: 0; overflow: hidden; margin-bottom: 2px; }
    </style>
  </head>
  <body>
    <!-- SVG sprite for UI icons -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
      <!-- Refresh / reconnect -->
      <symbol id="icon-refresh" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12a9 9 0 1 0 .001 1"/>
          <path d="M21 8v4h-4" stroke-width="2.25"/>
          <path d="M3 16v-4h4" stroke-width="2.25"/>
        </g>
      </symbol>

      <!-- Restart -->
      <symbol id="icon-restart" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 3v6"/>
          <path d="M7 6.5A9 9 0 1 0 21 12"/>
          <path d="M21 5l-3 3l-3-3"/>
        </g>
      </symbol>

      <!-- Stop (square) -->
      <symbol id="icon-stop" viewBox="0 0 24 24">
        <rect x="6" y="6" width="12" height="12" rx="2" ry="2" fill="currentColor" />
      </symbol>

      <!-- File with plus -->
      <symbol id="icon-file-plus" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"/>
          <path d="M14 3v5h5"/>
          <path d="M12 11v6"/>
          <path d="M9 14h6"/>
        </g>
      </symbol>

      <!-- Eye (show) -->
      <symbol id="icon-eye" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-7 11-7s11 7 11 7s-4 7-11 7S1 12 1 12z"/>
          <circle cx="12" cy="12" r="3"/>
        </g>
      </symbol>

      <!-- Eye off (hide) -->
      <symbol id="icon-eye-off" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 3l18 18"/>
          <path d="M10.584 10.584A3 3 0 0 0 12 15a3 3 0 0 0 3-3c0-.39-.074-.762-.209-1.104"/>
          <path d="M9.88 4.14A12.4 12.4 0 0 1 12 4c7 0 11 8 11 8a20.1 20.1 0 0 1-3.223 4.343"/>
          <path d="M6.18 6.18A19.93 19.93 0 0 0 1 12s4 8 11 8c1.33 0 2.59-.25 3.76-.7"/>
        </g>
      </symbol>

      <!-- Broom (clear) -->
      <symbol id="icon-broom" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 20h8l-2-5l-6 2z"/>
          <path d="M15 3l-7 12"/>
          <path d="M18 6l-3-3"/>
          <path d="M20.5 8.5l-3-3"/>
        </g>
      </symbol>

      <!-- History (clock) -->
      <symbol id="icon-history" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2"/>
        </g>
      </symbol>

      <!-- Editor (show) -->
      <symbol id="icon-editor" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <rect x="4" y="5" width="16" height="14" rx="2" ry="2"/>
          <path d="M7 9h10"/>
          <path d="M7 12h10"/>
          <path d="M7 15h10"/>
        </g>
      </symbol>

      <!-- Editor off (hide) -->
      <symbol id="icon-editor-off" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round">
          <rect x="4" y="5" width="16" height="14" rx="2" ry="2"/>
          <path d="M7 9h10"/>
          <path d="M7 12h10"/>
          <path d="M7 15h10"/>
          <path d="M3 3l18 18"/>
        </g>
      </symbol>
    </svg>

    <div id="root">
      <div id="topbar">
        <span class="dot" id="dot" style="background:#aaa"></span>
        <span class="status" id="status">disconnected</span>
        <button id="btnReconnect" class="icon-btn" title="Reconnect" data-tip="Reconnect" aria-label="Reconnect">
          <svg aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-refresh" /></svg>
        </button>
        <button id="btnRestart" class="icon-btn" title="Restart" data-tip="Restart" aria-label="Restart">
          <svg aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-restart" /></svg>
        </button>
        <button id="btnStop" class="icon-btn danger" title="Send Ctrl+C to process" data-tip="Send Ctrl+C to process" aria-label="Stop">
          <svg aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-stop" /></svg>
        </button>
        <div class="separator"></div>
        <button id="btnToggleChips" class="icon-btn" aria-expanded="true" aria-controls="chipbar" title="Hide Chips" data-tip="Hide Chips" aria-label="Hide Chips">
          <svg class="icon-when-expanded" aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-eye-off" /></svg>
          <svg class="icon-when-collapsed" aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-eye" /></svg>
        </button>
        <button id="btnToggleComposer" class="icon-btn" aria-expanded="true" aria-controls="composer" title="Hide Editor" data-tip="Hide Editor" aria-label="Hide Editor">
          <svg class="icon-when-expanded" aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-editor-off" /></svg>
          <svg class="icon-when-collapsed" aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-editor" /></svg>
        </button>
        <button id="btnClear" class="icon-btn" title="Clear all chips and highlights" data-tip="Clear all chips and highlights" aria-label="Clear">
          <svg aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-broom" /></svg>
        </button>
        <button id="btnHistory" class="icon-btn" title="Show prompt history" data-tip="Show prompt history" aria-label="History">
          <svg aria-hidden="true" viewBox="0 0 24 24"><use href="#icon-history" /></svg>
        </button>
        <label>Font: <input type="number" id="fontSize" value="12" min="8" max="32" style="width:56px"></label>
        <span class="status" id="state">Unknown</span>
      </div>
      <div id="chipbar"></div>
      <div id="term"></div>
      <div id="composer" aria-label="Command editor"></div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="history-modal hidden" role="dialog" aria-modal="true" aria-labelledby="historyTitle">
      <div class="history-modal-backdrop"></div>
      <div class="history-modal-content">
        <div class="history-modal-header">
          <h2 id="historyTitle">Prompt History</h2>
          <div class="history-modal-controls">
            <div class="history-search-container">
              <input type="text" id="historySearchInput" placeholder="Search prompts..." aria-label="Search prompts" />
              <button id="historySearchClear" class="history-search-clear" title="Clear search" aria-label="Clear search" style="display: none;">Ã—</button>
            </div>
            <label class="history-filter-toggle">
              <input type="checkbox" id="historyShowAll" />
              <span>Show all projects</span>
            </label>
            <button id="historyCloseBtn" class="icon-btn" title="Close" aria-label="Close history">
              <svg aria-hidden="true" viewBox="0 0 24 24">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="history-modal-body">
          <div id="historyList" class="history-list">
            <!-- History items will be populated here -->
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
    
    <!-- macOS keyboard and drag event handling moved to TypeScript modules -->
    <script>
      // macOS keyboard event handling is now done by the KeyboardHandler in keyboardHandler.ts
      // macOS drag and drop event handling is now done by the MessageDispatcher in handlers.ts
    </script>
  </body>
</html>
